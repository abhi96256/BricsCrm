<!DOCTYPE html>
<html>
<head>
    <title>Test Database vs Frontend Filtering</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .db-result, .frontend-result { padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîç Database vs Frontend Filtering Test</h1>
    
    <div class="test-section">
        <h2>Step 1: Create Test Tasks</h2>
        <button onclick="createTaskForSarah()">Create Task for Sarah</button>
        <button onclick="createTaskForJohn()">Create Task for John</button>
        <button onclick="createTaskForAdmin()">Create Task for Admin</button>
        <div id="createResult"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 2: Compare Database vs Frontend Filtering</h2>
        <button onclick="compareFiltering()">Compare Filtering Methods</button>
        <div id="comparisonResult"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 3: Test Backend Filtering API</h2>
        <button onclick="testBackendFiltering()">Test Backend Filtering</button>
        <div id="backendResult"></div>
    </div>
    
    <script>
        function showResult(elementId, message, type = 'info') {
            const div = document.getElementById(elementId);
            div.innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        async function createTaskForSarah() {
            try {
                const response = await fetch('http://localhost:5000/api/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: 'Database Test Task for Sarah',
                        description: 'This task tests database filtering',
                        assignedTo: '4', // Sarah's ID
                        machine: '1',
                        deadline: '2025-08-20',
                        priority: 'High'
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('createResult', `‚úÖ Task created for Sarah: ${data.data.title}`, 'success');
                } else {
                    showResult('createResult', `‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('createResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function createTaskForJohn() {
            try {
                const response = await fetch('http://localhost:5000/api/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: 'Database Test Task for John',
                        description: 'This task tests database filtering',
                        assignedTo: '3', // John's ID
                        machine: '2',
                        deadline: '2025-08-25',
                        priority: 'Medium'
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('createResult', `‚úÖ Task created for John: ${data.data.title}`, 'success');
                } else {
                    showResult('createResult', `‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('createResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function createTaskForAdmin() {
            try {
                const response = await fetch('http://localhost:5000/api/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: 'Database Test Task for Admin',
                        description: 'This task tests database filtering',
                        assignedTo: '1', // Admin's ID
                        machine: '1',
                        deadline: '2025-08-30',
                        priority: 'Low'
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('createResult', `‚úÖ Task created for Admin: ${data.data.title}`, 'success');
                } else {
                    showResult('createResult', `‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('createResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function compareFiltering() {
            try {
                // Get all tasks from database
                const response = await fetch('http://localhost:5000/api/tasks');
                const data = await response.json();
                
                if (response.ok) {
                    const allTasks = data.data;
                    
                    // Frontend filtering for Sarah (Employee)
                    const sarahTasksFrontend = allTasks.filter(task => task.assignedTo === '4');
                    
                    // Backend filtering for Sarah
                    const backendResponse = await fetch('http://localhost:5000/api/tasks/filter/4');
                    const backendData = await backendResponse.json();
                    
                    let result = `<h3>üîç Filtering Comparison</h3>`;
                    result += `<div class="comparison">`;
                    
                    // Frontend filtering result
                    result += `<div class="frontend-result">`;
                    result += `<h4>Frontend Filtering (Sarah's Tasks)</h4>`;
                    result += `<p><strong>Total tasks in DB:</strong> ${allTasks.length}</p>`;
                    result += `<p><strong>Sarah's tasks (frontend filtered):</strong> ${sarahTasksFrontend.length}</p>`;
                    if (sarahTasksFrontend.length > 0) {
                        result += `<ul>`;
                        sarahTasksFrontend.forEach(task => {
                            result += `<li>${task.title} (${task.priority})</li>`;
                        });
                        result += `</ul>`;
                    }
                    result += `</div>`;
                    
                    // Backend filtering result
                    result += `<div class="db-result">`;
                    result += `<h4>Backend Filtering (Sarah's Tasks)</h4>`;
                    if (backendResponse.ok) {
                        result += `<p><strong>User Role:</strong> ${backendData.userRole}</p>`;
                        result += `<p><strong>Sarah's tasks (backend filtered):</strong> ${backendData.data.length}</p>`;
                        if (backendData.data.length > 0) {
                            result += `<ul>`;
                            backendData.data.forEach(task => {
                                result += `<li>${task.title} (${task.priority})</li>`;
                            });
                            result += `</ul>`;
                        }
                    } else {
                        result += `<p class="error">‚ùå Backend filtering failed</p>`;
                    }
                    result += `</div>`;
                    
                    result += `</div>`;
                    
                    // Check if results match
                    if (sarahTasksFrontend.length === backendData.data.length) {
                        result += `<p class="success">‚úÖ Frontend and Backend filtering results match!</p>`;
                    } else {
                        result += `<p class="error">‚ùå Frontend and Backend filtering results don't match!</p>`;
                    }
                    
                    document.getElementById('comparisonResult').innerHTML = result;
                } else {
                    showResult('comparisonResult', `‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('comparisonResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function testBackendFiltering() {
            try {
                const users = [
                    { id: '1', name: 'Admin', role: 'Admin' },
                    { id: '2', name: 'Sub Admin', role: 'Sub Admin' },
                    { id: '3', name: 'John Manager', role: 'Manager' },
                    { id: '4', name: 'Sarah Employee', role: 'Employee' }
                ];
                
                let result = `<h3>üß™ Backend Filtering Test</h3>`;
                
                for (const user of users) {
                    try {
                        const response = await fetch(`http://localhost:5000/api/tasks/filter/${user.id}`);
                        const data = await response.json();
                        
                        if (response.ok) {
                            result += `<div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">`;
                            result += `<h4>${user.name} (${user.role})</h4>`;
                            result += `<p><strong>User Role:</strong> ${data.userRole}</p>`;
                            result += `<p><strong>Tasks Count:</strong> ${data.data.length}</p>`;
                            
                            if (data.data.length > 0) {
                                result += `<p><strong>Tasks:</strong></p><ul>`;
                                data.data.slice(0, 3).forEach(task => {
                                    result += `<li>${task.title} (Assigned to: ${task.assignedTo})</li>`;
                                });
                                if (data.data.length > 3) {
                                    result += `<li>... and ${data.data.length - 3} more</li>`;
                                }
                                result += `</ul>`;
                            }
                            result += `</div>`;
                        } else {
                            result += `<p class="error">‚ùå Error for ${user.name}: ${data.message}</p>`;
                        }
                    } catch (error) {
                        result += `<p class="error">‚ùå Error for ${user.name}: ${error.message}</p>`;
                    }
                }
                
                document.getElementById('backendResult').innerHTML = result;
            } catch (error) {
                showResult('backendResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html> 